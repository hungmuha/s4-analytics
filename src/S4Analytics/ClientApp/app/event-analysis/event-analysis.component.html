<section class="event-analysis-grid">
    <div class="filters">filters</div>
    <div class="filter-controls">filter controls</div>
    <div class="scope">
        Date/Time
        <a href="javascript:void(0)" (click)="openModal(dateTimeScope)">
            <span class="badge badge-secondary">
                {{dateTimeLabel}}
                <span class="fa fa-caret-down"></span>
            </span>
        </a>
        Place
        <a href="javascript:void(0)" (click)="openModal(placeScope)">
            <span class="badge badge-secondary">
                County: Alachua
                <span class="fa fa-caret-down"></span>
            </span>
        </a>
    </div>
    <div class="map-controls">
        Total: {{totalCount}} / Mapped: {{mappedCount}} / Unmapped: {{unmappedCount}}
    </div>
    <div class="map" id="mapArea">
        <event-map mapId="eventMap"></event-map>
    </div>
    <kendo-grid [class]="['attributes']"
                [data]="state.crashGridData"
                [pageSize]="state.gridPageSize"
                [scrollable]="'virtual'"
                [skip]="state.crashGridSkip"
                [pageable]="true"
                [rowHeight]="35"
                (pageChange)="pageChange($event)">
        <kendo-grid-column field="id" title="Id"></kendo-grid-column>
        <kendo-grid-column field="hsmvReportNumber" title="Report Number"></kendo-grid-column>
        <kendo-grid-column field="crashDate" title="Date"></kendo-grid-column>
        <kendo-grid-column field="crashTime" title="Time"></kendo-grid-column>
        <kendo-grid-column field="agncyNm" title="Agency Name"></kendo-grid-column>
    </kendo-grid>
    <div class="attribute-controls">attribute controls</div>
</section>

<ng-template #dateTimeScope let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Date/Time</h4>
        <button type="button" class="close" aria-label="Close" (click)="d()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col-6">
                From date <kendo-datepicker [(value)]="state.startDate"></kendo-datepicker>
            </div>
            <div class="col-6">
                To date<kendo-datepicker [(value)]="state.endDate"></kendo-datepicker>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-dark" (click)="c()">Apply</button>
    </div>
</ng-template>

<ng-template #placeScope let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Place</h4>
        <button type="button" class="close" aria-label="Close" (click)="d()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <button-group [multipleSelect]="false"
                      [items]="['Statewide','County','City']"
                      [(ngModel)]="geoExtent"></button-group>
        <kendo-multiselect *ngIf="geoExtent==='County'"
                           [filterable]="true"
                           [data]="filteredCounties"
                           textField="name"
                           valueField="key"
                           (filterChange)="filterCounties($event)"
                           [(ngModel)]="counties"></kendo-multiselect>
        <kendo-multiselect *ngIf="geoExtent==='City'"
                           [filterable]="true"
                           [data]="filteredCities"
                           textField="name"
                           valueField="key"
                           (filterChange)="filterCities($event)"
                           [(ngModel)]="cities"></kendo-multiselect>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-dark" (click)="c()">Apply</button>
    </div>
</ng-template>
